(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,n){e.exports=n.p+"static/media/doge.69ae4e8f.png"},19:function(e,t,n){e.exports=n(38)},26:function(e,t,n){},28:function(e,t,n){},30:function(e,t,n){},32:function(e,t,n){},36:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);n(20);var a=n(1),s=n.n(a),i=n(10),c=n.n(i),o=(n(26),n(11)),r=n(5),l=n(6),u=n(8),p=n(7),m=n(9),h=n(3);n(28);var g=n(4),d=n(17),f=n.n(d),y=function(e){function t(){return Object(r.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.msgs[0].userid;return s.a.createElement("li",{className:"media ow-wrap-break-word"},s.a.createElement("img",{className:"mr-3 avatar rounded-circle",src:f.a,alt:"Avatar"}),s.a.createElement("div",{className:"media-body",style:{minWidth:"0"}},s.a.createElement("h5",{className:"mt-0"},e),s.a.createElement("ul",{className:"list-unstyled d-flex flex-column"},this.props.msgs.map(function(e,t){return s.a.createElement("li",{key:"".concat(t,"sub").concat(e.date)},e.message)}),s.a.createElement("li",{className:"mt-2 font-weight-light text-muted align-self-end"},function(e){var t=new Date(e),n=new Date-t,a=[t.getDay(),t.getDate(),t.getMonth(),t.getFullYear(),t.getHours(),t.getMinutes(),t.getSeconds()],s=a[1],i=a[2],c=a[3],o=a[4],r=a[5],l=a[6];return n>60*(24-o)*60*1e3?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a[0]]," at ").concat(o,":").concat(r,":").concat(l," - ").concat(s,".").concat(i,".").concat(c):(r<10&&(r="".concat("0",r)),"".concat(o,":").concat(r))}(this.props.msgs[this.props.msgs.length-1].date)))))}}]),t}(a.Component),v=(n(30),n(32),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={value:""},n.delayBetweenTypingStates=1e4,n.handleChange=n.handleChange.bind(Object(h.a)(Object(h.a)(n))),n.sendChatMessage=n.sendChatMessage.bind(Object(h.a)(Object(h.a)(n))),n.notifyStartTyping=n.notifyStartTyping.bind(Object(h.a)(Object(h.a)(n))),n.notifyStoppedTyping=n.notifyStoppedTyping.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.typingTimeoutID)}},{key:"sendChatMessage",value:function(e){e.preventDefault(),this.notifyStoppedTyping(),this.props.send({type:"chat",message:this.state.value}),this.setState({value:""})}},{key:"handleChange",value:function(e){this.notifyStartTyping(),this.setState({value:e.target.value})}},{key:"notifyStartTyping",value:function(){""!==this.state.value&&(clearTimeout(this.typingTimeoutID),this.timerIsRunning?this.typingTimeoutID=setTimeout(this.notifyStoppedTyping,this.delayBetweenTypingStates):(this.props.send({type:"started_typing"}),this.timerIsRunning=!0,this.typingTimeoutID=setTimeout(this.notifyStoppedTyping,this.delayBetweenTypingStates)))}},{key:"notifyStoppedTyping",value:function(){this.props.send({type:"stopped_typing"}),this.timerIsRunning=!1,clearTimeout(this.typingTimeoutID)}},{key:"render",value:function(){return s.a.createElement(g.c,{fluid:!0,style:{minHeight:"0"},className:"d-flex flex-column flex-grow-1"},this.props.isOpen&&s.a.createElement(g.g,{className:"flex-grow-1",style:{overflow:"auto"}},s.a.createElement(g.a,{className:"flex-grow-1"},s.a.createElement(b,{messages:this.props.messages}))),!this.props.isOpen&&s.a.createElement(g.g,{className:"flex-grow-1",style:{overflow:"auto"}},s.a.createElement(g.a,{className:"flex-grow-1 d-flex flex-column justify-content-center align-items-center"},s.a.createElement("div",{className:"d-flex flex-column align-items-center"},s.a.createElement("div",{className:"spinner"},s.a.createElement("div",{className:"double-bounce1"}),s.a.createElement("div",{className:"double-bounce2"})),s.a.createElement("p",{style:{}},"Connecting...")))),s.a.createElement(g.g,{className:"flex-shrink-0"},s.a.createElement(g.a,{className:"",style:{height:"2em"}},s.a.createElement(O,{typers:this.props.typers}))),s.a.createElement(g.g,{className:"flex-shrink-0"},s.a.createElement(g.a,null,s.a.createElement("form",{onSubmit:this.sendChatMessage,disabled:!this.props.isOpen},s.a.createElement("div",{className:"input-group mb-3"},s.a.createElement("input",{autoComplete:"off",disabled:!this.props.isOpen,value:this.state.value,onChange:this.handleChange,placeholder:"Message...",type:"text",className:"form-control",required:!0}),s.a.createElement("div",{className:"input-group-append"},s.a.createElement("button",{className:"input-group-text",type:"submit",disabled:!this.props.isOpen},"Send")))))))}}]),t}(a.Component)),b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).scrollToBottom=n.scrollToBottom.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){this.messagesEnd.scrollIntoView()}},{key:"render",value:function(){var e,t,n=this,a=(e=this.props.messages,t="userid",e.reduce(function(e,n){if(e.length){var a=e.pop();return a[a.length-1][t]===n[t]?(a.push(n),e.push(a),e):(e.push(a),e.push([n]),e)}return e.push([n]),e},[])).map(function(e,t){return s.a.createElement(y,{msgs:e,key:"msg-group-"+t})});return a=(a=a.map(function(e,t){return[e,s.a.createElement("hr",{key:"hr"+t})]}).flat()).slice(0,-1),s.a.createElement("ul",{className:"list-unstyled"},a,s.a.createElement("li",{ref:function(e){n.messagesEnd=e}}))}}]),t}(a.Component);function O(e){return e.typers.length?1===e.typers.length?s.a.createElement("span",null,e.typers[0]," is typing a message..."):2===e.typers.length?s.a.createElement("span",null,e.typers[0]," and ",e.typers[1]," are typing a message..."):s.a.createElement("span",null,e.typers[0],", ",e.typers[1]," and ",e.typers.length-2," other users are typing..."):null}var E=v,j=(n(36),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).toggle=n.toggle.bind(Object(h.a)(Object(h.a)(n))),n.state={isOpen:!1},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"render",value:function(){return s.a.createElement(g.d,{className:"bg-dark flex-shrink-0",color:"light",dark:!0},s.a.createElement(g.e,{className:"mr-auto text-light"},"active users"),s.a.createElement(g.f,{onClick:this.toggle,className:"mr-2"}),s.a.createElement(g.b,{isOpen:this.state.isOpen,navbar:!0},s.a.createElement("hr",null),s.a.createElement("div",{className:"text-light"},this.props.users.map(function(e,t){return s.a.createElement("p",{key:"header-user-"+t},e)}))))}}]),t}(a.Component)),k=function(){function e(){Object(r.a)(this,e),this._listeners=new Set}return Object(l.a)(e,[{key:"listen",value:function(e,t){this._listeners.add({name:e,callback:t})}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this._listeners.forEach(function(t){t.name===e&&t.callback.apply(t,n)})}}]),e}(),w=function(){function e(t){var n=this;Object(r.a)(this,e),this.events=new k,this.connection=new WebSocket(t),this.connection.addEventListener("open",function(){n.events.emit("open")}),this.connection.addEventListener("message",function(e){var t=JSON.parse(e.data);n.events.emit(t.type,t.data)})}return Object(l.a)(e,[{key:"send",value:function(e){var t=JSON.stringify(e);this.connection.send(t)}}]),e}(),S=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={messages:[],users:[],typers:[],isOpen:!1},n.connection=null,n.send=n.send.bind(Object(h.a)(Object(h.a)(n))),n.toggleOpenState=n.toggleOpenState.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.getServerUrl();this.connection=new w(t),this.connection.events.listen("open",function(){console.log("Connection established!"),e.toggleOpenState()}),this.connection.events.listen("chat",function(t){var n=t.userid,a=t.message,s=t.date;e.setState(function(e){return{messages:Object(o.a)(e.messages).concat([{userid:n,message:a,date:s}])}})}),this.connection.events.listen("chat_history",function(t){console.log("Received a chat log of",t.messages.length,"messages.");var n=t.messages;e.setState({messages:n})}),this.connection.events.listen("server_broadcast",function(t){var n=t.peers.you,a=t.peers.clients,s=new Set([n].concat(Object(o.a)(a.map(function(e){return e.id}))));e.setState({users:Object(o.a)(s)})}),this.connection.events.listen("user_started_typing",function(t){console.log("A user started typing");var n=t.userid;e.setState(function(e){return{typers:Object(o.a)(e.typers).concat([n])}})}),this.connection.events.listen("user_stopped_typing",function(t){console.log("A user stopped typing");var n=t.userid;e.setState(function(e){return{typers:e.typers.filter(function(e){return e!==n})}})})}},{key:"getServerUrl",value:function(){return"localhost"===window.location.hostname?"ws://localhost:9876":"wss://fred-im.herokuapp.com"}},{key:"render",value:function(){return s.a.createElement("div",{className:"App d-flex flex-column",style:{height:"100vh"}},s.a.createElement(j,{users:this.state.users}),s.a.createElement(E,{users:this.state.users,typers:this.state.typers,messages:this.state.messages,send:this.send,isOpen:this.state.isOpen}))}},{key:"send",value:function(e){this.connection.send(e)}},{key:"toggleOpenState",value:function(){this.setState(function(e){return{isOpen:!e.isOpen}})}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.ad38dbe3.chunk.js.map