(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,a){e.exports=a(24)},18:function(e,t,a){},20:function(e,t,a){},22:function(e,t,a){},24:function(e,t,a){"use strict";a.r(t);a(12);var n=a(0),s=a.n(n),i=a(10),r=a.n(i),c=(a(18),a(2)),o=a(3),l=a(5),u=a(4),d=a(6),h=(a(20),a(7)),m=a(1),p=function(){function e(t){Object(c.a)(this,e),this.chat=t,this.conn=null,this.id=null,this.peers=new Map,this.send=this.send.bind(this)}return Object(o.a)(e,[{key:"connect",value:function(e){var t=this;this.conn=new WebSocket(e),this.conn.addEventListener("open",function(){console.log("Connection established!")}),this.conn.addEventListener("message",function(e){t.receive(e.data)})}},{key:"isOpen",value:function(){return this.conn.readyState===WebSocket.OPEN}},{key:"receive",value:function(e){var t=JSON.parse(e);if("chat"===t.type)console.log("Received message",t),this.chat.addMessage(t.data.userid,t.data.message,t.data.date);else if("server_broadcast"===t.type){console.log("Received message",t.type);var a=new Set;a.add(t.data.peers.you),t.data.peers.clients.forEach(function(e){return a.add(e.id)}),this.chat.updateUserList(a)}else if("chat_history"===t.type){console.log("Received message",t.type);var n=t.data.messages;this.chat.addHistory(n)}else"user_started_typing"===t.type?this.chat.addCurrentTyper(t.data.userid):"user_stopped_typing"===t.type?this.chat.removeCurrentTyper(t.data.userid):"pong"===t.type&&console.log("Ping pong successful.")}},{key:"send",value:function(e){var t=JSON.stringify(e);console.log("Sending message",t),this.conn.send(t)}}]),e}();a(22);var g=a(8),v=a.n(g),y=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={value:"",messages:[],users:[],typers:[]},a.connectionManager=null,a.handleChange=a.handleChange.bind(Object(m.a)(Object(m.a)(a))),a.sendChatMessage=a.sendChatMessage.bind(Object(m.a)(Object(m.a)(a))),a.send=a.send.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"getServerUrl",value:function(){return"localhost"===window.location.hostname?"ws://localhost:9876":"wss://fred-im.herokuapp.com"}},{key:"componentDidMount",value:function(){var e=this.getServerUrl();this.connectionManager=new p(this),this.connectionManager.connect(e),this.pingTimeoutId=setTimeout(this.send,3e4,{type:"ping"})}},{key:"sendChatMessage",value:function(e){e.preventDefault(),this.send({type:"chat",message:this.state.value}),this.setState({value:""})}},{key:"send",value:function(e){clearInterval(this.typingTimeoutId),clearInterval(this.pingTimeoutId),this.connectionManager.send({type:"stopped_typing"}),this.connectionManager.send(e),this.pingTimeoutId=setTimeout(this.send,3e4,{type:"ping"})}},{key:"addCurrentTyper",value:function(e){if(0===this.state.typers.filter(function(t){return t===e}).length){var t=Object(h.a)(this.state.typers).concat([e]);this.setState({typers:t})}}},{key:"removeCurrentTyper",value:function(e){var t=this.state.typers.filter(function(t){return t!==e});this.setState({typers:t})}},{key:"handleChange",value:function(e){e.target.value.length>this.state.value.length&&(this.send({type:"started_typing"}),this.typingTimeoutId=setTimeout(this.send,1e4,{type:"stopped_typing"})),""===e.target.value&&(clearInterval(this.typingTimeoutId),this.send({type:"stopped_typing"})),this.setState({value:e.target.value})}},{key:"addHistory",value:function(e){this.setState({messages:e}),this.scrollToBottom()}},{key:"addMessage",value:function(e,t,a){var n,s=(n=this.state.messages,JSON.parse(JSON.stringify(n)));s=Object(h.a)(s).concat([{userid:e,message:t,date:a}]),this.setState({messages:s}),this.scrollToBottom()}},{key:"updateUserList",value:function(e){this.setState({users:e})}},{key:"scrollToBottom",value:function(){var e=this.messageList.scrollHeight-this.messageList.clientHeight;this.messageList.scrollTop=e>0?e:0}},{key:"render",value:function(){var e,t,a=this,n=(e=this.state.messages,t="userid",e.reduce(function(e,a){if(e.length){var n=e.pop();return n[n.length-1][t]===a[t]?(n.push(a),e.push(n),e):(e.push(n),e.push([a]),e)}return e.push([a]),e},[])).map(function(e){return s.a.createElement(f,{msgs:e,key:e[0].date})});n=(n=n.map(function(e,t){return[e,s.a.createElement("hr",{className:"no-margin",key:"hr"+t})]}).flat()).slice(0,-1);var i=Object(h.a)(this.state.users).map(function(e){return s.a.createElement(E,{user:e,key:e})});return s.a.createElement("div",{className:"container-fluid h-100"},s.a.createElement("div",{className:"row h-100 no-gutters"},s.a.createElement("div",{className:"col-9 d-flex flex-column left-col"},s.a.createElement("ul",{className:"messages-container list-unstyled",ref:function(e){return a.messageList=e}},s.a.createElement("div",null,n)),s.a.createElement(b,{typers:this.state.typers}),s.a.createElement("form",{className:"mr-3",onSubmit:this.sendChatMessage},s.a.createElement("div",{className:"form-group row"},s.a.createElement("div",{className:"col"},s.a.createElement("input",{className:"form-control",id:"message-input",placeholder:"Message...",type:"text",onChange:this.handleChange,value:this.state.value}))))),s.a.createElement("div",{className:"col userlist"},"Active users",s.a.createElement("ul",{className:"list-unstyled"},i))))}}]),t}(n.Component),f=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.msgs[0],t=e.userid,a=e.date;return s.a.createElement("li",{className:"media message",key:a},s.a.createElement("img",{src:v.a,className:"align-self-end imagedoge mr-3 mb-4",alt:"avatar.png"}),s.a.createElement("div",{className:"media-body d-flex flex-column"},s.a.createElement("h5",null,t),this.props.msgs.map(function(e,a){return s.a.createElement("div",{className:"wrap",key:"".concat(t,"-").concat(a)},e.message)}),s.a.createElement("div",{className:"align-self-end mr-3"},function(e){var t=new Date(e),a=new Date-t,n=[t.getDay(),t.getDate(),t.getMonth(),t.getFullYear(),t.getHours(),t.getMinutes(),t.getSeconds()],s=n[1],i=n[2],r=n[3],c=n[4],o=n[5],l=n[6];return a>60*(24-c)*60*1e3?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n[0]]," at ").concat(c,":").concat(o,":").concat(l," - ").concat(s,".").concat(i,".").concat(r):(o<10&&(o="".concat("0",o)),"".concat(c,":").concat(o))}(this.props.msgs[this.props.msgs.length-1].date))))}}]),t}(n.Component);function b(e){var t=Object(h.a)(e.typers);if(0===t.length)return s.a.createElement("p",null);var a=t.length>1?" are ":" is ";return s.a.createElement("p",null,t.join(", ")+a+"typing.")}function E(e){return s.a.createElement("li",{key:e.user,className:"media"},s.a.createElement("img",{className:"image-small imagedoge mr-1",src:v.a,alt:"avatar"}),s.a.createElement("div",{className:"media-body"},s.a.createElement("h5",{className:"mt-2"},e.user)))}var O=y,k=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(O,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,a){e.exports=a.p+"static/media/doge.69ae4e8f.png"}},[[11,2,1]]]);
//# sourceMappingURL=main.1a0a5810.chunk.js.map