(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,a){e.exports=a.p+"static/media/doge.69ae4e8f.png"},19:function(e,t,a){e.exports=a(34)},26:function(e,t,a){},28:function(e,t,a){},30:function(e,t,a){},34:function(e,t,a){"use strict";a.r(t);a(20);var n=a(1),s=a.n(n),c=a(4),i=a.n(c),o=(a(26),a(5)),r=a(6),l=a(8),u=a(7),m=a(9),d=(a(28),a(15)),h=a(3),g=function(){function e(t){Object(o.a)(this,e),this.chat=t,this.conn=null,this.id=null,this.peers=new Map,this.send=this.send.bind(this)}return Object(r.a)(e,[{key:"connect",value:function(e){var t=this;this.conn=new WebSocket(e),this.conn.addEventListener("open",function(){console.log("Connection established!")}),this.conn.addEventListener("message",function(e){t.receive(e.data)})}},{key:"isOpen",value:function(){return this.conn.readyState===WebSocket.OPEN}},{key:"receive",value:function(e){var t=JSON.parse(e);if("chat"===t.type)console.log("Received message",t),this.chat.addMessage(t.data.userid,t.data.message,t.data.date);else if("server_broadcast"===t.type){console.log("Received message",t.type);var a=new Set;a.add(t.data.peers.you),t.data.peers.clients.forEach(function(e){return a.add(e.id)}),this.chat.updateUserList(a)}else if("chat_history"===t.type){console.log("Received message",t.type);var n=t.data.messages;this.chat.addHistory(n)}else"pong"===t.type&&console.log("Ping pong successful.")}},{key:"send",value:function(e){var t=JSON.stringify(e);console.log("Sending message",t),this.conn.send(t)}}]),e}(),v=a(10);a(30);var p=a(11),f=a.n(p),y=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={value:"",messages:[],users:[]},a.connectionManager=null,a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.sendChatMessage=a.sendChatMessage.bind(Object(h.a)(Object(h.a)(a))),a.send=a.send.bind(Object(h.a)(Object(h.a)(a))),a}return Object(m.a)(t,e),Object(r.a)(t,[{key:"getServerUrl",value:function(){return"localhost"===window.location.hostname?"ws://localhost:9876":"wss://fred-im.herokuapp.com"}},{key:"componentDidMount",value:function(){var e=this.getServerUrl();this.connectionManager=new g(this),this.connectionManager.connect(e),this.timeoutId=setTimeout(this.send,3e4,{type:"ping"})}},{key:"sendChatMessage",value:function(e){e.preventDefault(),this.send({type:"chat",message:this.state.value}),this.setState({value:""})}},{key:"send",value:function(e){clearInterval(this.timeoutId),this.connectionManager.send(e),this.timeoutId=setTimeout(this.send,3e4,{type:"ping"})}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"addHistory",value:function(e){this.setState({messages:e}),this.scrollToBottom()}},{key:"addMessage",value:function(e,t,a){var n,s=(n=this.state.messages,JSON.parse(JSON.stringify(n)));s=Object(d.a)(s).concat([{userid:e,message:t,date:a}]),this.setState({messages:s}),this.scrollToBottom()}},{key:"updateUserList",value:function(e){this.setState({users:e})}},{key:"scrollToBottom",value:function(){var e=this.messageList.scrollHeight-this.messageList.clientHeight;this.messageList.scrollTop=e>0?e:0}},{key:"render",value:function(){var e,t,a=this,n=(e=this.state.messages,t="userid",e.reduce(function(e,a){if(e.length){var n=e.pop();return n[n.length-1][t]===a[t]?(n.push(a),e.push(n),e):(e.push(n),e.push([a]),e)}return e.push([a]),e},[])).map(function(e){return s.a.createElement(b,{msgs:e,key:e[0].date})});n=(n=n.map(function(e,t){return[e,s.a.createElement("hr",{key:"hr"+t})]}).flat()).slice(0,-1);var c=Object(d.a)(this.state.users).map(function(e){return s.a.createElement(E,{user:e,key:e})});return s.a.createElement("div",{className:"container-fluid h-100"},s.a.createElement("div",{className:"row h-100"},s.a.createElement("div",{className:"col-9 d-flex flex-column"},s.a.createElement("div",{className:"row flex-fill"},s.a.createElement("div",{className:"col messages-container mb-3 d-flex flex-column",ref:function(e){a.messageList=e}},s.a.createElement("ul",{className:"list-unstyled messages "},n))),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col p-2 chat-form"},s.a.createElement(v.b,{onSubmit:this.sendChatMessage},s.a.createElement(v.c,{row:!0},s.a.createElement(v.a,null,s.a.createElement(v.d,{id:"message-input",placeholder:"Message...",type:"text",onChange:this.handleChange,value:this.state.value}))))))),s.a.createElement("div",{className:"col userlist"},"Active users",s.a.createElement("ul",{className:"list-unstyled"},c))))}}]),t}(n.Component),b=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.msgs[0],t=e.userid,a=e.date;return s.a.createElement("li",{className:"media",key:a},s.a.createElement("img",{src:f.a,className:"align-self-end imagedoge mr-3 mb-4",alt:"avatar.png"}),s.a.createElement("div",{className:"media-body d-flex flex-column"},s.a.createElement("h5",null,t),this.props.msgs.map(function(e,a){return s.a.createElement("div",{key:"".concat(t,"-").concat(a)},s.a.createElement("div",null," ",e.message," "))}),s.a.createElement("div",{className:"align-self-end mr-3"},function(e){var t=new Date(e);return(new Date-t)/1e3/60/60>24?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()],". ").concat(t.getDate(),".").concat(t.getMonth(),".").concat(t.getFullYear()," - ").concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds()):"".concat(t.getHours(),":").concat(t.getMinutes())}(this.props.msgs[this.props.msgs.length-1].date))))}}]),t}(n.Component);function E(e){return s.a.createElement("li",{key:e.user,className:"media"},s.a.createElement("img",{className:"image-small imagedoge mr-1",src:f.a,alt:"avatar"}),s.a.createElement("div",{className:"media-body"},s.a.createElement("h5",{className:"mt-2"},e.user)))}var O=y,k=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(O,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.62849903.chunk.js.map