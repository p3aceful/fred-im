(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,n){e.exports=n.p+"static/media/doge.69ae4e8f.png"},19:function(e,t,n){e.exports=n(36)},26:function(e,t,n){},28:function(e,t,n){},32:function(e,t,n){},34:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);n(20);var a=n(1),s=n.n(a),i=n(10),r=n.n(i),o=(n(26),n(11)),c=n(5),l=n(6),u=n(8),p=n(7),m=n(9),h=n(3);n(28);var d=n(4),g=n(17),y=n.n(g),f=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.msgs[0].userid;return s.a.createElement(d.d,null,s.a.createElement(d.d,{left:!0,top:!0},s.a.createElement(d.d,{object:!0,className:"avatar mr-2 rounded-circle",src:y.a,alt:"avatar"})),s.a.createElement(d.d,{body:!0,className:"wrap d-flex flex-column"},s.a.createElement(d.d,{heading:!0},e),this.props.msgs.map(function(e,t){return s.a.createElement("div",{key:e.date},e.message)}),s.a.createElement("div",{className:"align-self-end text-muted"},function(e){var t=new Date(e),n=new Date-t,a=[t.getDay(),t.getDate(),t.getMonth(),t.getFullYear(),t.getHours(),t.getMinutes(),t.getSeconds()],s=a[1],i=a[2],r=a[3],o=a[4],c=a[5],l=a[6];return n>60*(24-o)*60*1e3?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a[0]]," at ").concat(o,":").concat(c,":").concat(l," - ").concat(s,".").concat(i,".").concat(r):(c<10&&(c="".concat("0",c)),"".concat(o,":").concat(c))}(this.props.msgs[this.props.msgs.length-1].date))))}}]),t}(a.Component),v=(n(32),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={value:""},n.delayBetweenTypingStates=1e4,n.handleChange=n.handleChange.bind(Object(h.a)(Object(h.a)(n))),n.sendChatMessage=n.sendChatMessage.bind(Object(h.a)(Object(h.a)(n))),n.notifyStartTyping=n.notifyStartTyping.bind(Object(h.a)(Object(h.a)(n))),n.notifyStoppedTyping=n.notifyStoppedTyping.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.typingTimeoutID)}},{key:"sendChatMessage",value:function(e){e.preventDefault(),this.notifyStoppedTyping(),this.props.send({type:"chat",message:this.state.value}),this.setState({value:""})}},{key:"handleChange",value:function(e){this.notifyStartTyping(),this.setState({value:e.target.value})}},{key:"notifyStartTyping",value:function(){""!==this.state.value&&(clearTimeout(this.typingTimeoutID),this.timerIsRunning?this.typingTimeoutID=setTimeout(this.notifyStoppedTyping,this.delayBetweenTypingStates):(this.props.send({type:"started_typing"}),this.timerIsRunning=!0,this.typingTimeoutID=setTimeout(this.notifyStoppedTyping,this.delayBetweenTypingStates)))}},{key:"notifyStoppedTyping",value:function(){this.props.send({type:"stopped_typing"}),this.timerIsRunning=!1,clearTimeout(this.typingTimeoutID)}},{key:"render",value:function(){var e,t,n=(e=this.props.messages,t="userid",e.reduce(function(e,n){if(e.length){var a=e.pop();return a[a.length-1][t]===n[t]?(a.push(n),e.push(a),e):(e.push(a),e.push([n]),e)}return e.push([n]),e},[])).map(function(e,t){return s.a.createElement(f,{msgs:e,key:"msg-group-"+t})});n=(n=n.map(function(e,t){return[e,s.a.createElement("hr",{key:"hr"+t})]}).flat()).slice(0,-1);var a=this.props.users.map(function(e,t){return s.a.createElement("p",{className:"ml-2 font-weight-light",key:"lgitem-"+t},"- ",e)});return s.a.createElement(d.c,{fluid:!0,className:"h-100"},s.a.createElement(d.h,{className:" h-100"},s.a.createElement(d.a,{sm:"8",className:"col-left mh-100 bg-light"},s.a.createElement("div",{className:"d-flex flex-column h-100"},s.a.createElement("div",{className:"d-flex flex-column flex-grow-1 mh-100"},s.a.createElement("div",{className:"overflow-container mh-100"},s.a.createElement(b,{messages:n})),s.a.createElement("p",{className:"flex-shrink-0"},s.a.createElement(O,{typers:this.props.typers})),s.a.createElement("form",{className:"flex-shrink-0",onSubmit:this.sendChatMessage},s.a.createElement("div",{className:"form-group row"},s.a.createElement("div",{className:"col"},s.a.createElement("input",{className:"form-control bg-dark text-light",id:"message-input",placeholder:"Message...",type:"text",onChange:this.handleChange,value:this.state.value}))))))),s.a.createElement(d.a,{sm:"4",className:"col-right bg-dark text-light d-none d-sm-block"},s.a.createElement("p",{className:"mt-3 ml-2"},"Active yousers"),a)))}}]),t}(a.Component)),b=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).scrollToBottom=n.scrollToBottom.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){this.messagesEnd.scrollIntoView({behavior:"smooth"})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"overflow-content mr-3",ref:function(t){return e.messageList=t}},s.a.createElement("div",null,this.props.messages),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(a.Component);function O(e){return e.typers.length?1===e.typers.length?s.a.createElement("span",null,e.typers[0]," is typing a message..."):2===e.typers.length?s.a.createElement("span",null,e.typers[0]," and ",e.typers[1]," are typing a message..."):s.a.createElement("span",null,e.typers[0],", ",e.typers[1]," and ",e.typers.length-2," other users are typing..."):null}var E=v,j=(n(34),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).toggle=n.toggle.bind(Object(h.a)(Object(h.a)(n))),n.state={isOpen:!1},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"render",value:function(){return s.a.createElement(d.e,{className:"bg-dark",id:"my-header",color:"light",dark:!0,fixed:"top"},s.a.createElement(d.f,{className:"mr-auto text-light"},"active users"),s.a.createElement(d.g,{onClick:this.toggle,className:"mr-2"}),s.a.createElement(d.b,{isOpen:this.state.isOpen,navbar:!0},s.a.createElement("hr",null),s.a.createElement("div",null,this.props.users.map(function(e,t){return s.a.createElement("p",{key:"header-user-"+t},e)}))))}}]),t}(a.Component)),k=function(){function e(t){Object(c.a)(this,e),this.uiManager=t,this.conn=null,this.id=null,this.peers=new Map,this.send=this.send.bind(this)}return Object(l.a)(e,[{key:"connect",value:function(e){var t=this;this.conn=new WebSocket(e),this.conn.addEventListener("open",function(){console.log("Connection established!")}),this.conn.addEventListener("message",function(e){t.receive(e.data)})}},{key:"isOpen",value:function(){return this.conn.readyState===WebSocket.OPEN}},{key:"receive",value:function(e){var t=JSON.parse(e);if("chat"===t.type){var n=t.data,a=n.userid,s=n.message,i=n.date;console.log("Received a new message from",a),this.uiManager.receiveMessage(a,s,i)}else if("chat_history"===t.type){console.log("Received a chat log of",t.data.messages.length,"messages.");var r=t.data.messages;this.uiManager.receiveChatHistory(r)}else if("server_broadcast"===t.type){var c=t.data.peers.you,l=t.data.peers.clients;this.uiManager.receiveActiveUsers([c].concat(Object(o.a)(l.map(function(e){return e.id}))))}else"pong"===t.type?console.log("Ping pong successful."):"user_started_typing"===t.type?(console.log("A user started typing"),this.uiManager.addToTypers(t.data.userid)):"user_stopped_typing"===t.type&&(console.log("A user stopped typing"),this.uiManager.removeFromTypers(t.data.userid))}},{key:"send",value:function(e){var t=JSON.stringify(e);console.log("Sending message",t),this.conn.send(t)}}]),e}(),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={messages:[],users:[],typers:[]},n.connectionManager=null,n.send=n.send.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.getServerUrl();this.connectionManager=new k(this),this.connectionManager.connect(e),this.pingTimeoutId=setTimeout(this.send,3e4,{type:"ping"})}},{key:"removeFromTypers",value:function(e){this.setState(function(t){return{typers:t.typers.filter(function(t){return t!==e})}})}},{key:"getServerUrl",value:function(){return"localhost"===window.location.hostname?"ws://localhost:9876":"wss://fred-im.herokuapp.com"}},{key:"receiveChatHistory",value:function(e){this.setState({messages:e})}},{key:"receiveMessage",value:function(e,t,n){this.setState(function(a){return{messages:Object(o.a)(a.messages).concat([{userid:e,message:t,date:n}])}})}},{key:"receiveActiveUsers",value:function(e){var t=new Set(e);this.setState({users:Object(o.a)(t)})}},{key:"render",value:function(){return s.a.createElement("div",{className:"App d-flex flex-column"},s.a.createElement(j,{users:this.state.users}),s.a.createElement(E,{users:this.state.users,typers:this.state.typers,messages:this.state.messages,send:this.send}))}},{key:"send",value:function(e){clearTimeout(this.pingTimeoutId),this.pingTimeoutId=setTimeout(this.send,3e4,{type:"ping"}),this.connectionManager.send(e)}},{key:"addToTypers",value:function(e){this.setState(function(t){return{typers:Object(o.a)(t.typers).concat([e])}})}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.601ba5f9.chunk.js.map